!function(e){"use strict";function t(e){return parseInt(e.replace(/px|%/,""),10)}e.module("scrollable-table",[]).directive("scrollableTable",["$timeout","$q","$parse",function(n,r,i){return{transclude:!0,restrict:"E",scope:{rows:"=watch",sortFn:"="},template:'<div class="scrollableContainer"><div class="headerSpacer"></div><div class="scrollArea" ng-transclude></div></div>',controller:["$scope","$element","$attrs",function(s,o,a){function l(e,t){var n=s.sortExpr.match(/(.+)\s+as\s+(.+)/),r={};r[n[1]]=e;var o=i(n[2])(r);r[n[1]]=t;var a=i(n[2])(r);return o===a?0:o>a?1:-1}function c(e){var t=o.find(".headerSpacer").height(),n=o.find(".scrollArea").scrollTop();o.find(".scrollArea").scrollTop(n+e.position().top-t)}function d(){function e(){0===o.find("table:visible").length?n(e,100):t.resolve()}var t=r.defer();return n(e),t.promise}function h(){o.find("thead th .th-inner").length||o.find("thead th").wrapInner('<div class="th-inner"></div>'),o.find("thead th .th-inner:not(:has(.box))").length&&o.find("thead th .th-inner:not(:has(.box))").wrapInner('<div class="box"></div>'),o.find("table th .th-inner:visible").each(function(n,r){r=e.element(r);var i=r.parent().width(),s=o.find("table th:visible:last"),a=i;if("center"!==s.css("text-align")){var l=o.find(".scrollArea").height()<o.find("table").height();s[0]==r.parent()[0]&&l&&(a+=o.find(".scrollArea").width()-o.find("tbody tr").width(),a=Math.max(a,i))}var c=t(r.parent().css("min-width")),d=r.parent().attr("title");a=Math.max(c,a),r.css("width",a),d||(d=r.find(".title .ng-scope").html()||r.find(".box").html()),r.attr("title",d.trim())}),u.resolve()}function f(){for(var e=d().then(h),t=s.headerResizeHanlers||[],n=0;n<t.length;n++)e=e.then(t[n]);return e}this.getSortExpr=function(){return s.sortExpr},this.isAsc=function(){return s.asc},this.setSortExpr=function(e){s.asc=!0,s.sortExpr=e},this.toggleSort=function(){s.asc=!s.asc},this.doSort=function(e){s.rows.sort(e?function(t,n){var r=e(t,n);return s.asc?r:-1*r}:function(e,t){var n=l(e,t);return s.asc?n:-1*n})},this.renderTalble=function(){return d().then(h)},this.getTableElement=function(){return o},this.appendTableResizingHandler=function(e){for(var t=s.headerResizeHanlers||[],n=0;n<t.length;n++)if(t[n].name===e.name)return;t.push(e),s.headerResizeHanlers=t},s.$on("rowSelected",function(e,t){var n=o.find(".scrollArea table tr[row-id='"+t+"']");1===n.length&&r.all([d(),u.promise]).then(function(){c(n)})});var u=r.defer();s.$watch("rows",function(e){e&&(f(o.find(".scrollArea").width()),s.sortExpr=null,o.find(".scrollArea").scrollTop(0))}),s.asc=!a.hasOwnProperty("desc"),s.sortAttr=a.sortAttr,o.find(".scrollArea").scroll(function(e){o.find("thead th .th-inner").css("margin-left",0-e.target.scrollLeft)}),s.$on("renderScrollableTable",function(){f(o.find(".scrollArea").width())}),e.element(window).on("resize",function(){s.$apply()}),s.$watch(function(){return o.find(".scrollArea").width()},function(e,t){0>=e*t||f()})}]}}]).directive("sortableHeader",[function(){return{transclude:!0,scope:!0,require:"^scrollableTable",template:'<div class="box"><div ng-mouseenter="enter()" ng-mouseleave="leave()"><div class="title" ng-transclude></div><span class="orderWrapper"><span class="order" ng-show="focused || isActive()" ng-click="toggleSort($event)" ng-class="{active:isActive()}"><i ng-show="isAscending()" class="glyphicon glyphicon-chevron-up"></i><i ng-show="!isAscending()" class="glyphicon glyphicon-chevron-down"></i></span></span></div></div>',link:function(t,n,r,i){var s=r.on||"a as a."+r.col;t.element=e.element(n),t.isActive=function(){return i.getSortExpr()===s},t.toggleSort=function(e){t.isActive()?i.toggleSort():i.setSortExpr(s),i.doSort(t[r.comparatorFn]),e.preventDefault()},t.isAscending=function(){return t.focused&&!t.isActive()?!0:i.isAsc()},t.enter=function(){t.focused=!0},t.leave=function(){t.focused=!1},t.isLastCol=function(){return n.parent().find("th:last-child").get(0)===n.get(0)}}}}])}(angular);